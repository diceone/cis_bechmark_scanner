# CIS SUSE Linux Enterprise 15 Benchmark v1.1.1 Level 1
# Based on CIS SUSE Linux Enterprise 15 Benchmark v1.1.1

# 1 Initial Setup
- id: "1.1.1.1"
  description: "Ensure mounting of cramfs filesystems is disabled"
  command: "modprobe -n -v cramfs"
  expected: "install /bin/true"

- id: "1.1.1.2"
  description: "Ensure mounting of freevxfs filesystems is disabled"
  command: "modprobe -n -v freevxfs"
  expected: "install /bin/true"

- id: "1.1.1.3"
  description: "Ensure mounting of jffs2 filesystems is disabled"
  command: "modprobe -n -v jffs2"
  expected: "install /bin/true"

- id: "1.1.1.4"
  description: "Ensure mounting of hfs filesystems is disabled"
  command: "modprobe -n -v hfs"
  expected: "install /bin/true"

- id: "1.1.1.5"
  description: "Ensure mounting of hfsplus filesystems is disabled"
  command: "modprobe -n -v hfsplus"
  expected: "install /bin/true"

# 1.2 Configure Software Updates
- id: "1.2.1"
  description: "Ensure GPG keys are configured"
  command: "rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release} --> %{summary}\n'"
  expected: "gpg-pubkey"

- id: "1.2.2"
  description: "Ensure zypper repository is configured"
  command: "zypper repos | grep -E '^[[:space:]]*#|^[[:space:]]*$|^[[:space:]]*\\[|enabled = 1'"
  expected: "enabled = 1"

# 2 Services
- id: "2.1.1"
  description: "Ensure xinetd is not installed"
  command: "rpm -q xinetd"
  expected: "package xinetd is not installed"

- id: "2.1.2"
  description: "Ensure openbsd-inetd is not installed"
  command: "rpm -q inetd"
  expected: "package inetd is not installed"

# 2.2 Special Purpose Services
- id: "2.2.1"
  description: "Ensure NIS Client is not installed"
  command: "rpm -q ypbind"
  expected: "package ypbind is not installed"

- id: "2.2.2"
  description: "Ensure rsh client is not installed"
  command: "rpm -q rsh"
  expected: "package rsh is not installed"

- id: "2.2.3"
  description: "Ensure talk client is not installed"
  command: "rpm -q talk"
  expected: "package talk is not installed"

# 3 Network Configuration
- id: "3.1.1"
  description: "Ensure IP forwarding is disabled"
  command: "sysctl net.ipv4.ip_forward"
  expected: "net.ipv4.ip_forward = 0"

- id: "3.1.2"
  description: "Ensure packet redirect sending is disabled"
  command: "sysctl net.ipv4.conf.all.send_redirects"
  expected: "net.ipv4.conf.all.send_redirects = 0"

# 4 Logging and Auditing
- id: "4.1.1.1"
  description: "Ensure auditd is installed"
  command: "rpm -q audit"
  expected: "audit"

- id: "4.1.1.2"
  description: "Ensure auditd service is enabled"
  command: "systemctl is-enabled auditd"
  expected: "enabled"

# 5 Access, Authentication and Authorization
- id: "5.1.1"
  description: "Ensure cron daemon is enabled"
  command: "systemctl is-enabled cron"
  expected: "enabled"

- id: "5.1.2"
  description: "Ensure permissions on /etc/crontab are configured"
  command: "stat /etc/crontab"
  expected: "Access: (0600/-rw-------)"

# 6 System Maintenance
- id: "6.1.1"
  description: "Ensure permissions on /etc/passwd are configured"
  command: "stat /etc/passwd"
  expected: "Access: (0644/-rw-r--r--)"

- id: "6.1.2"
  description: "Ensure permissions on /etc/shadow are configured"
  command: "stat /etc/shadow"
  expected: "Access: (0000/----------)"

# SLES 15 Specific
- id: "7.1.1"
  description: "Ensure AppArmor is installed"
  command: "rpm -q apparmor"
  expected: "apparmor"

- id: "7.1.2"
  description: "Ensure AppArmor is enabled in the bootloader configuration"
  command: "grep \"apparmor=1\" /etc/default/grub"
  expected: "apparmor=1"

- id: "7.2.1"
  description: "Ensure Wicked Network Manager is configured properly"
  command: "systemctl is-enabled wicked"
  expected: "enabled"

- id: "7.3.1"
  description: "Ensure YAST2 Security Settings are configured"
  command: "rpm -q yast2-security"
  expected: "yast2-security"

- id: "7.4.1"
  description: "Ensure Snapper is configured for system snapshots"
  command: "snapper list-configs | grep \"root\""
  expected: "root"

- id: "7.5.1"
  description: "Ensure firewalld is installed and enabled"
  command: "systemctl is-enabled firewalld"
  expected: "enabled"

# SELinux/AppArmor
- id: "8.1.1"
  description: "Ensure AppArmor is not disabled in bootloader configuration"
  command: "grep -E \"apparmor=0|security=none\" /etc/default/grub"
  expected: ""

- id: "8.1.2"
  description: "Ensure AppArmor is running in enforce mode"
  command: "aa-status | grep \"enforce\""
  expected: "enforce"

# Time Synchronization
- id: "9.1.1"
  description: "Ensure chrony is configured"
  command: "rpm -q chrony"
  expected: "chrony"

# System File Permissions
- id: "10.1.1"
  description: "Ensure system file permissions are configured"
  command: "rpm -Va --nomtime --nosize --nomd5 --nolinkto"
  expected: ""

# User Accounts and Environment
- id: "11.1.1"
  description: "Ensure password expiration is 365 days or less"
  command: "grep PASS_MAX_DAYS /etc/login.defs"
  expected: "PASS_MAX_DAYS   365"

# Warning Banners
- id: "12.1.1"
  description: "Ensure message of the day is configured properly"
  command: "grep -E -i \"(\\v|\\r|\\m|\\s|$(grep '^ID=' /etc/os-release | cut -d= -f2 | sed -e 's/\"//g'))\" /etc/motd"
  expected: ""
